version: '3'
services:
  wallabag:
    image: wallabag/wallabag:2.4.2
    restart: always
    environment:
      SYMFONY__ENV__SECRET: ${SECRET}
      SYMFONY__ENV__DOMAIN_NAME: ${DOMAIN_NAME}
      SYMFONY__ENV__SENTRY_DSN: ${SENTRY_DSN}
      SYMFONY__ENV__SERVER_NAME: ${SERVER_NAME}
      SYMFONY__ENV__FROM_EMAIL: ${FROM_EMAIL}
      SYMFONY__ENV__MAILER_HOST: ${MAILER_HOST}
      SYMFONY__ENV__MAILER_PORT: ${MAILER_PORT}
      SYMFONY__ENV__MAILER_ENCRYPTION: ssl
      SYMFONY__ENV__MAILER_USER: ${MAILER_USER}
      SYMFONY__ENV__MAILER_PASSWORD: ${MAILER_PASSWORD}
      SYMFONY__ENV__TWOFACTOR_SENDER: ${TWOFACTOR_SENDER}
      SYMFONY__ENV__FOSUSER_REGISTRATION: "false"
    expose:
      - "80"
    volumes:
      - image-data:/var/www/wallabag/web/assets/images
      - app-data:/var/www/wallabag/data
    depends_on:
      - redis
    labels:
      - traefik.http.routers.wallabag.rule=Host(`${HOST}`)
      - traefik.http.routers.wallabag.tls=true
    networks:
      - traefik
      - default
  redis:
    image: redis:alpine
    restart: always
    volumes:
      - redis-data:/data
    labels:
      - "traefik.enable=false"

volumes:
  redis-data:
  image-data:
  app-data:

networks:
  traefik:
    external: true
